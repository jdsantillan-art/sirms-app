{% extends 'base.html' %}

{% block title %}Report Detail - {{ report.case_id }} - SIRMS{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-6">
    <!-- Header Section -->
    <div class="flex justify-between items-center mb-6">
        <div>
            <h1 class="text-2xl font-bold text-gray-900 mb-1">Case {{ report.case_id }}</h1>
            <p class="text-sm text-gray-500">{{ report.incident_type.name|default:"Incident Report" }}</p>
        </div>
        <div class="flex space-x-3">
            <button onclick="history.back()" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors">
                <i class="fas fa-arrow-left mr-2"></i>Back
            </button>
            <button onclick="window.print()" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors">
                <i class="fas fa-print mr-2"></i>Print
            </button>
        </div>
    </div>
    
    <!-- Status Summary Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
            <div class="text-xs font-medium text-gray-500 mb-1">Case ID</div>
            <div class="text-lg font-bold text-blue-600">{{ report.case_id }}</div>
        </div>
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
            <div class="text-xs font-medium text-gray-500 mb-1">Priority</div>
            <div class="text-lg font-bold {% if classification.severity == 'major' %}text-red-600{% else %}text-yellow-600{% endif %}">
                {% if classification %}{{ classification.get_severity_display }}{% else %}Pending{% endif %}
            </div>
        </div>
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
            <div class="text-xs font-medium text-gray-500 mb-1">Status</div>
            <div class="text-lg font-bold {% if report.status == 'resolved' %}text-green-600{% elif report.status == 'sanctioned' %}text-red-600{% elif report.status == 'evaluated' %}text-purple-600{% else %}text-orange-600{% endif %}">
                {{ report.get_status_display }}
            </div>
        </div>
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
            <div class="text-xs font-medium text-gray-500 mb-1">Reported</div>
            <div class="text-lg font-bold text-gray-700">{{ report.created_at|timesince }} ago</div>
        </div>
    </div>
    
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Main Content -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Incident Information -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                    <h2 class="text-lg font-semibold text-gray-900">Incident Information</h2>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2 block">Reporter</label>
                            <p class="text-sm font-medium text-gray-900">{{ report.reporter_first_name }} {{ report.reporter_last_name }}</p>
                            <p class="text-xs text-gray-500 mt-1">{{ report.reporter.get_role_display }}</p>
                        </div>
                        <div>
                            <label class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2 block">Incident Date & Time</label>
                            <p class="text-sm font-medium text-gray-900">{{ report.incident_date|date:"M d, Y" }} {{ report.incident_time|time:"g:i A" }}</p>
                            <p class="text-xs text-gray-500 mt-1">G{{ report.grade_level }} - {{ report.section_name }}</p>
                        </div>
                    </div>
                    
                    {% if report.description %}
                    <div class="mb-6">
                        <label class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2 block">Description</label>
                        <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                            <p class="text-sm text-gray-700 leading-relaxed whitespace-pre-wrap">{{ report.description }}</p>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if report.involved_students %}
                    <div class="mb-6">
                        <label class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2 block">Involved Students</label>
                        <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
                            <p class="text-sm text-gray-900">{{ report.involved_students }}</p>
                            {% if is_repeat_offender %}
                            <div class="mt-3 inline-flex items-center px-3 py-1.5 rounded-full bg-red-100 text-red-800 border border-red-300">
                                <i class="fas fa-exclamation-triangle mr-2 text-xs"></i>
                                <span class="text-xs font-semibold">REPEATED OFFENDER ({{ repeat_count }}x previous)</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if report.evidence %}
                    <div>
                        <label class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2 block">Evidence</label>
                        {% if 'cloudinary' in report.evidence.url or 'res.cloudinary.com' in report.evidence.url %}
                            <!-- New Cloudinary file - will work -->
                            <a href="{{ report.evidence.url }}" target="_blank" class="inline-flex items-center px-4 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors text-sm font-medium">
                                <i class="fas fa-paperclip mr-2"></i>View Evidence
                            </a>
                        {% else %}
                            <!-- Old file - may not exist -->
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                                <div class="flex items-start">
                                    <i class="fas fa-exclamation-triangle text-yellow-600 mt-1 mr-3"></i>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-yellow-900 mb-1">Evidence File Not Available</p>
                                        <p class="text-xs text-yellow-700 mb-3">This evidence was uploaded before our cloud storage upgrade and is no longer accessible. Please re-upload the evidence file.</p>
                                        {% if user.is_authenticated and user.role in 'counselor,do,principal' %}
                                        <a href="{% url 'edit_report' report.id %}" class="inline-flex items-center px-3 py-1.5 bg-yellow-600 text-white rounded text-xs font-medium hover:bg-yellow-700 transition-colors">
                                            <i class="fas fa-upload mr-1.5"></i>Re-upload Evidence
                                        </a>
                                        {% endif %}
                                    </div>
                  >
                      v>
                   %}
            >
                    {% endif %}       </div dif     {% en      </di     </div          
                </div>
            </div>
            
            <!-- Student Information -->
            {% if report.reported_student %}
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                    <h2 class="text-lg font-semibold text-gray-900">Student Information</h2>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2 block">Full Name</label>
                            <p class="text-sm font-medium text-gray-900">{{ report.reported_student.get_full_name }}</p>
                        </div>
                        <div>
                            <label class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2 block">Student ID</label>
                            <p class="text-sm font-mono font-medium text-gray-900">{{ report.reported_student.username }}</p>
                        </div>
                        <div>
                            <label class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2 block">Email</label>
                            <p class="text-sm text-gray-900">{{ report.reported_student.email|default:"N/A" }}</p>
                        </div>
                        <div>
                            <label class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2 block">Grade & Section</label>
                            <p class="text-sm font-medium text-gray-900">G{{ report.grade_level }} - {{ report.section_name }}</p>
                        </div>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                    <h2 class="text-lg font-semibold text-gray-900">Academic Information</h2>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2 block">Curriculum</label>
                            <p class="text-sm text-gray-900">{{ report.curriculum.name|default:"N/A" }}</p>
                        </div>
                        <div>
                            <label class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2 block">Grade & Section</label>
                            <p class="text-sm font-medium text-gray-900">G{{ report.grade_level }} - {{ report.section_name }}</p>
                        </div>
                        <div>
                            <label class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2 block">Teacher</label>
                            <p class="text-sm text-gray-900">{{ report.teacher_name|default:"N/A" }}</p>
                        </div>
                        <div>
                            <label class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2 block">Track</label>
                            <p class="text-sm text-gray-900">{{ report.track.name|default:"N/A" }}</p>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Classification -->
            {% if classification %}
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200 bg-gray-50 flex justify-between items-center">
                    <h2 class="text-lg font-semibold text-gray-900">Classification</h2>
                    <span class="px-3 py-1 rounded-full text-xs font-semibold {% if classification.severity == 'major' %}bg-red-100 text-red-800{% else %}bg-yellow-100 text-yellow-800{% endif %}">
                        {{ classification.get_severity_display }}
                    </span>
                </div>
                <div class="p-6">
                    {% if classification.internal_notes %}
                    <div class="mb-4">
                        <label class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2 block">Internal Notes</label>
                        <div class="bg-yellow-50 rounded-lg p-4 border border-yellow-200">
                            <p class="text-sm text-gray-700 leading-relaxed">{{ classification.internal_notes }}</p>
                        </div>
                    </div>
                    {% endif %}
                    <div class="text-xs text-gray-500">
                        Classified by <span class="font-medium text-gray-700">{{ classification.classified_by.get_full_name }}</span> on {{ classification.classified_at|date:"M d, Y H:i" }}
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Counselor Evaluation -->
            {% if report.evaluation %}
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                    <h2 class="text-lg font-semibold text-gray-900">Counselor Evaluation</h2>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2 block">Recommendation</label>
                            <span class="inline-flex items-center px-4 py-2 rounded-lg text-sm font-semibold
                                {% if report.evaluation.recommendation == 'sanction' %}bg-red-100 text-red-800
                                {% elif report.evaluation.recommendation == 'counseling' %}bg-blue-100 text-blue-800
                                {% elif report.evaluation.recommendation == 'monitoring' %}bg-yellow-100 text-yellow-800
                                {% else %}bg-green-100 text-green-800{% endif %}">
                                {{ report.evaluation.get_recommendation_display }}
                            </span>
                        </div>
                        <div>
                            <label class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2 block">Repeat Offender</label>
                            <span class="inline-flex items-center px-4 py-2 rounded-lg text-sm font-semibold {% if report.evaluation.is_repeat_offender %}bg-red-100 text-red-800{% else %}bg-green-100 text-green-800{% endif %}">
                                {% if report.evaluation.is_repeat_offender %}<i class="fas fa-exclamation-triangle mr-2"></i>Yes{% else %}<i class="fas fa-check-circle mr-2"></i>No{% endif %}
                            </span>
                        </div>
                    </div>
                    
                    {% if report.evaluation.evaluation_notes %}
                    <div class="mb-6">
                        <label class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2 block">Evaluation Notes</label>
                        <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                            <p class="text-sm text-gray-700 leading-relaxed whitespace-pre-wrap">{{ report.evaluation.evaluation_notes }}</p>
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="pt-4 border-t border-gray-200">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div>
                                <span class="text-gray-500">Evaluated by:</span>
                                <span class="font-medium text-gray-900 ml-2">{{ report.evaluation.evaluated_by.get_full_name }}</span>
                            </div>
                            <div>
                                <span class="text-gray-500">Date:</span>
                                <span class="font-medium text-gray-900 ml-2">{{ report.evaluation.evaluated_at|date:"M d, Y H:i" }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Sanction Information -->
            {% if report.sanction %}
            <div class="bg-white rounded-xl shadow-sm border border-red-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200 bg-red-50">
                    <h2 class="text-lg font-semibold text-gray-900">Sanction Details</h2>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2 block">Sanction Type</label>
                            <span class="inline-flex items-center px-4 py-2 rounded-lg text-sm font-semibold bg-red-100 text-red-800">
                                {{ report.sanction.get_sanction_type_display }}
                            </span>
                        </div>
                        <div>
                            <label class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2 block">Duration</label>
                            <p class="text-sm font-medium text-gray-900">
                                {% if report.sanction.duration_days %}
                                    {{ report.sanction.duration_days }} day{{ report.sanction.duration_days|pluralize }}
                                {% else %}
                                    N/A
                                {% endif %}
                            </p>
                        </div>
                    </div>
                    
                    {% if report.sanction.reason %}
                    <div class="mb-6">
                        <label class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2 block">Reason</label>
                        <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                            <p class="text-sm text-gray-700 leading-relaxed">{{ report.sanction.reason }}</p>
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="pt-4 border-t border-gray-200">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm mb-4">
                            <div>
                                <span class="text-gray-500">Issued by:</span>
                                <span class="font-medium text-gray-900 ml-2">{{ report.sanction.issued_by.get_full_name }}</span>
                            </div>
                            <div>
                                <span class="text-gray-500">Issued on:</span>
                                <span class="font-medium text-gray-900 ml-2">{{ report.sanction.issued_at|date:"M d, Y H:i" }}</span>
                            </div>
                        </div>
                        {% if report.sanction.start_date %}
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div>
                                <span class="text-gray-500">Start Date:</span>
                                <span class="font-medium text-gray-900 ml-2">{{ report.sanction.start_date|date:"M d, Y" }}</span>
                            </div>
                            {% if report.sanction.end_date %}
                            <div>
                                <span class="text-gray-500">End Date:</span>
                                <span class="font-medium text-gray-900 ml-2">{{ report.sanction.end_date|date:"M d, Y" }}</span>
                            </div>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Counseling Sessions -->
            {% if counseling_sessions %}
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                    <h2 class="text-lg font-semibold text-gray-900">Counseling Sessions</h2>
                </div>
                <div class="p-6">
                    <div class="space-y-4">
                        {% for session in counseling_sessions %}
                        <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <h4 class="font-semibold text-gray-900 mb-1">Session {{ forloop.counter }}</h4>
                                    <p class="text-sm text-gray-600">{{ session.scheduled_date|date:"M d, Y H:i" }}</p>
                                </div>
                                <span class="px-3 py-1 rounded-full text-xs font-semibold {% if session.status == 'completed' %}bg-green-100 text-green-800{% elif session.status == 'scheduled' %}bg-blue-100 text-blue-800{% elif session.status == 'cancelled' %}bg-red-100 text-red-800{% else %}bg-yellow-100 text-yellow-800{% endif %}">
                                    {{ session.get_status_display }}
                                </span>
                            </div>
                            {% if session.remarks %}
                            <p class="text-sm text-gray-700 mb-2 leading-relaxed">{{ session.remarks }}</p>
                            {% endif %}
                            <p class="text-xs text-gray-500">
                                Counselor: <span class="font-medium text-gray-700">{{ session.counselor.get_full_name }}</span>
                            </p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Internal Notes -->
            {% if internal_notes and user.role in 'do,counselor,principal' %}
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                    <h2 class="text-lg font-semibold text-gray-900">Internal Notes</h2>
                </div>
                <div class="p-6">
                    <div class="space-y-4">
                        {% for note in internal_notes %}
                        <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-semibold text-gray-900">{{ note.author.get_full_name }}</h4>
                                <span class="text-xs text-gray-500">{{ note.created_at|date:"M d, Y H:i" }}</span>
                            </div>
                            <p class="text-sm text-gray-700 leading-relaxed mb-2">{{ note.note }}</p>
                            {% if note.is_private %}
                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-800">
                                <i class="fas fa-lock mr-1"></i>Private
                            </span>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
        
        <!-- Sidebar -->
        <div class="lg:col-span-1">
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden sticky top-6">
                <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                    <h2 class="text-lg font-semibold text-gray-900">Case Timeline</h2>
                </div>
                <div class="p-6">
                    <!-- Timeline -->
                    <div class="space-y-4 relative pl-6 border-l-2 border-gray-200">
                        <div class="relative">
                            <div class="absolute -left-8 top-1 w-4 h-4 bg-green-500 rounded-full border-2 border-white shadow-sm"></div>
                            <div>
                                <p class="font-semibold text-sm text-gray-900">Report Submitted</p>
                                <p class="text-xs text-gray-500 mt-1">{{ report.created_at|date:"M d, Y H:i" }}</p>
                            </div>
                        </div>
                        
                        {% if report.status != 'pending' %}
                        <div class="relative">
                            <div class="absolute -left-8 top-1 w-4 h-4 bg-blue-500 rounded-full border-2 border-white shadow-sm"></div>
                            <div>
                                <p class="font-semibold text-sm text-gray-900">Under Review</p>
                                <p class="text-xs text-gray-500 mt-1">Processing...</p>
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if classification %}
                        <div class="relative">
                            <div class="absolute -left-8 top-1 w-4 h-4 bg-yellow-500 rounded-full border-2 border-white shadow-sm"></div>
                            <div>
                                <p class="font-semibold text-sm text-gray-900">Classified</p>
                                <p class="text-xs text-gray-500 mt-1">{{ classification.classified_at|date:"M d, Y H:i" }}</p>
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if report.evaluation %}
                        <div class="relative">
                            <div class="absolute -left-8 top-1 w-4 h-4 bg-purple-500 rounded-full border-2 border-white shadow-sm"></div>
                            <div>
                                <p class="font-semibold text-sm text-gray-900">Evaluated</p>
                                <p class="text-xs text-gray-500 mt-1">{{ report.evaluation.evaluated_at|date:"M d, Y H:i" }}</p>
                                <p class="text-xs text-purple-600 font-semibold mt-1">{{ report.evaluation.get_recommendation_display }}</p>
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if report.sanction %}
                        <div class="relative">
                            <div class="absolute -left-8 top-1 w-4 h-4 bg-red-500 rounded-full border-2 border-white shadow-sm"></div>
                            <div>
                                <p class="font-semibold text-sm text-gray-900">Sanctioned</p>
                                <p class="text-xs text-gray-500 mt-1">{{ report.sanction.issued_at|date:"M d, Y H:i" }}</p>
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if counseling_sessions %}
                        <div class="relative">
                            <div class="absolute -left-8 top-1 w-4 h-4 bg-indigo-500 rounded-full border-2 border-white shadow-sm"></div>
                            <div>
                                <p class="font-semibold text-sm text-gray-900">Counseling Scheduled</p>
                                <p class="text-xs text-gray-500 mt-1">{{ counseling_sessions|length }} session{{ counseling_sessions|length|pluralize }}</p>
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if report.status == 'resolved' %}
                        <div class="relative">
                            <div class="absolute -left-8 top-1 w-4 h-4 bg-green-600 rounded-full border-2 border-white shadow-sm"></div>
                            <div>
                                <p class="font-semibold text-sm text-gray-900">Resolved</p>
                                <p class="text-xs text-gray-500 mt-1">Case closed</p>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- Quick Info -->
                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <h3 class="text-sm font-semibold text-gray-900 mb-4">Quick Information</h3>
                        <div class="space-y-3 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-500">Case ID:</span>
                                <span class="font-semibold font-mono text-gray-900">{{ report.case_id }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-500">Status:</span>
                                <span class="font-semibold text-gray-900">{{ report.get_status_display }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-500">Priority:</span>
                                <span class="font-semibold {% if classification.severity == 'major' %}text-red-600{% else %}text-yellow-600{% endif %}">
                                    {% if classification %}{{ classification.get_severity_display }}{% else %}Pending{% endif %}
                                </span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-500">Days Open:</span>
                                <span class="font-semibold text-gray-900">{{ report.created_at|timesince }}</span>
                            </div>
                            {% if report.reported_student %}
                            <div class="flex justify-between">
                                <span class="text-gray-500">Student:</span>
                                <span class="font-semibold text-gray-900">{{ report.reported_student.get_full_name }}</span>
                            </div>
                            {% endif %}
                            {% if report.evaluation %}
                            <div class="flex justify-between">
                                <span class="text-gray-500">Recommendation:</span>
                                <span class="font-semibold {% if report.evaluation.recommendation == 'sanction' %}text-red-600{% elif report.evaluation.recommendation == 'counseling' %}text-blue-600{% elif report.evaluation.recommendation == 'monitoring' %}text-yellow-600{% else %}text-green-600{% endif %}">
                                    {{ report.evaluation.get_recommendation_display }}
                                </span>
                            </div>
                            {% endif %}
                            {% if report.evaluation.is_repeat_offender %}
                            <div class="flex justify-between">
                                <span class="text-gray-500">Repeat Offender:</span>
                                <span class="font-semibold text-red-600"><i class="fas fa-exclamation-triangle mr-1"></i>Yes</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Case Statistics -->
                    {% if user.role in 'counselor,principal' %}
                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <h3 class="text-sm font-semibold text-gray-900 mb-4">Statistics</h3>
                        <div class="space-y-3 text-sm">
                            {% if counseling_sessions %}
                            <div class="flex justify-between">
                                <span class="text-gray-500">Counseling Sessions:</span>
                                <span class="font-semibold text-gray-900">{{ counseling_sessions|length }}</span>
                            </div>
                            {% endif %}
                            {% if internal_notes %}
                            <div class="flex justify-between">
                                <span class="text-gray-500">Internal Notes:</span>
                                <span class="font-semibold text-gray-900">{{ internal_notes|length }}</span>
                            </div>
                            {% endif %}
                            {% if report.sanction %}
                            <div class="flex justify-between">
                                <span class="text-gray-500">Sanction Type:</span>
                                <span class="font-semibold text-red-600">{{ report.sanction.get_sanction_type_display }}</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
