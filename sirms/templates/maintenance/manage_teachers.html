{% extends 'base.html' %}

{% block title %}Manage Teachers - SIRMS{% endblock %}

{% block page_title %}Manage Teachers{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <!-- Teacher Accounts Section -->
    <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
        <div class="flex justify-between items-center">
            <div>
                <h2 class="text-2xl font-bold text-gray-800">Teacher Accounts</h2>
                <p class="text-gray-600 mt-1">Manage teacher user accounts</p>
            </div>
            <button onclick="openAddTeacherModal()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg flex items-center space-x-2">
                <i class="fas fa-plus"></i>
                <span>Add Teacher Account</span>
            </button>
        </div>
    </div>

    <!-- Teachers List -->
    <div class="bg-white rounded-lg shadow-sm overflow-hidden mb-8">
        <div class="p-6 border-b">
            <h3 class="text-lg font-semibold text-gray-800">Teacher Accounts</h3>
        </div>
        
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Teacher Name</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Username</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                    {% for teacher in teachers %}
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 text-sm font-medium text-gray-900">{{ teacher.get_full_name }}</td>
                        <td class="px-6 py-4 text-sm text-gray-600">{{ teacher.email }}</td>
                        <td class="px-6 py-4 text-sm text-gray-600">{{ teacher.username }}</td>
                        <td class="px-6 py-4 text-sm">
                            <span class="px-2 py-1 text-xs rounded {% if teacher.is_active %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %}">
                                {% if teacher.is_active %}Active{% else %}Inactive{% endif %}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-right text-sm">
                            <button type="button" onclick="editTeacher({{ teacher.id }}, '{{ teacher.first_name|escapejs }}', '{{ teacher.last_name|escapejs }}', '{{ teacher.email|escapejs }}')" 
                                    class="text-blue-600 hover:text-blue-900 mr-3">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button type="button" onclick="toggleTeacher({{ teacher.id }}, '{{ teacher.get_full_name|escapejs }}')" 
                                    class="text-orange-600 hover:text-orange-900 mr-3">
                                <i class="fas fa-toggle-on"></i> Toggle
                            </button>
                            <button type="button" onclick="deleteTeacher({{ teacher.id }}, '{{ teacher.get_full_name|escapejs }}')" 
                                    class="text-red-600 hover:text-red-900">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="px-6 py-8 text-center text-gray-500">
                            <i class="fas fa-inbox text-4xl mb-2"></i>
                            <p>No teachers found</p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Teacher Assignments Section -->
    <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
        <div class="flex justify-between items-center">
            <div>
                <h2 class="text-2xl font-bold text-gray-800">Teacher Assignments</h2>
                <p class="text-gray-600 mt-1">Manage teacher assignments to curriculum, track, grade, and section</p>
            </div>
            <button onclick="openAddAssignmentModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg flex items-center space-x-2">
                <i class="fas fa-plus"></i>
                <span>Add Assignment</span>
            </button>
        </div>
    </div>

    <!-- Assignments List -->
    <div class="bg-white rounded-lg shadow-sm overflow-hidden">
        <div class="p-6 border-b">
            <h3 class="text-lg font-semibold text-gray-800">All Assignments</h3>
        </div>
        
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Teacher Name</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Curriculum</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Track</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Grade</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Section</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                    {% for assignment in teacher_assignments %}
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 text-sm font-medium text-gray-900">{{ assignment.teacher_name }}</td>
                        <td class="px-6 py-4 text-sm text-gray-600">{{ assignment.curriculum.name|default:"N/A" }}</td>
                        <td class="px-6 py-4 text-sm text-gray-600">{{ assignment.track_code }}</td>
                        <td class="px-6 py-4 text-sm text-gray-600">Grade {{ assignment.grade_level }}</td>
                        <td class="px-6 py-4 text-sm text-gray-600">{{ assignment.section_name }}</td>
                        <td class="px-6 py-4 text-right text-sm">
                            <button type="button" onclick="editAssignment({{ assignment.id }}, '{{ assignment.teacher_name|escapejs }}', {{ assignment.curriculum.id|default:'null' }}, '{{ assignment.track_code|escapejs }}', '{{ assignment.grade_level|escapejs }}', '{{ assignment.section_name|escapejs }}')" 
                                    class="text-blue-600 hover:text-blue-900 mr-3">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button type="button" onclick="deleteAssignment({{ assignment.id }}, '{{ assignment.teacher_name|escapejs }}')" 
                                    class="text-red-600 hover:text-red-900">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                            <i class="fas fa-inbox text-4xl mb-2"></i>
                            <p>No assignments found</p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Add Teacher Modal -->
<div id="addTeacherModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
        <div class="p-6 border-b">
            <div class="flex justify-between items-center">
                <h3 class="text-xl font-semibold">Add Teacher Account</h3>
                <button onclick="closeAddTeacherModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        
        <form method="POST" class="p-6">
            {% csrf_token %}
            <input type="hidden" name="action" value="add_teacher">
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">First Name *</label>
                    <input type="text" name="first_name" id="id_first_name" required class="w-full px-4 py-2 border rounded-lg">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Last Name *</label>
                    <input type="text" name="last_name" id="id_last_name" required class="w-full px-4 py-2 border rounded-lg">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" name="email" id="teacher_email" class="w-full px-4 py-2 border rounded-lg" placeholder="Auto-generated if left empty">
                    <p class="text-xs text-gray-500 mt-1">
                        <i class="fas fa-info-circle"></i> Leave empty to auto-generate: first letter of first name + last name + dmlmhs.teacher@gmail.com
                    </p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Username *</label>
                    <input type="text" name="username" required class="w-full px-4 py-2 border rounded-lg">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password *</label>
                    <input type="password" name="password" required class="w-full px-4 py-2 border rounded-lg">
                </div>
            </div>
            
            <div class="flex justify-end space-x-3 mt-6">
                <button type="button" onclick="closeAddTeacherModal()" class="px-4 py-2 border rounded-lg">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-lg">Add Teacher</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Teacher Modal -->
<div id="editTeacherModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
        <div class="p-6 border-b">
            <div class="flex justify-between items-center">
                <h3 class="text-xl font-semibold">Edit Teacher Account</h3>
                <button onclick="closeEditTeacherModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        
        <form method="POST" class="p-6">
            {% csrf_token %}
            <input type="hidden" name="action" value="edit_teacher">
            <input type="hidden" name="teacher_id" id="edit_teacher_id">
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">First Name *</label>
                    <input type="text" name="first_name" id="edit_first_name" required class="w-full px-4 py-2 border rounded-lg">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Last Name *</label>
                    <input type="text" name="last_name" id="edit_last_name" required class="w-full px-4 py-2 border rounded-lg">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email *</label>
                    <input type="email" name="email" id="edit_email" required class="w-full px-4 py-2 border rounded-lg">
                </div>
            </div>
            
            <div class="flex justify-end space-x-3 mt-6">
                <button type="button" onclick="closeEditTeacherModal()" class="px-4 py-2 border rounded-lg">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg">Update Teacher</button>
            </div>
        </form>
    </div>
</div>

<!-- Add Assignment Modal -->
<div id="addAssignmentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
        <div class="p-6 border-b">
            <div class="flex justify-between items-center">
                <h3 class="text-xl font-semibold">Add Teacher Assignment</h3>
                <button onclick="closeAddAssignmentModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        
        <form method="POST" class="p-6">
            {% csrf_token %}
            <input type="hidden" name="action" value="add_assignment">
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Teacher Name *</label>
                    <input type="text" name="teacher_name" required class="w-full px-4 py-2 border rounded-lg" placeholder="Enter teacher's full name">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Curriculum *</label>
                    <select name="curriculum_id" id="add_assignment_curriculum" required class="w-full px-4 py-2 border rounded-lg">
                        <option value="">Select Curriculum</option>
                        {% for curriculum in curricula %}
                        <option value="{{ curriculum.id }}" data-name="{{ curriculum.name }}">{{ curriculum.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Grade Level *</label>
                    <select name="grade_level" id="add_assignment_grade" required class="w-full px-4 py-2 border rounded-lg">
                        <option value="">Select Grade</option>
                        <!-- Grades will be populated based on curriculum selection -->
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Track/Strand *</label>
                    <select name="track_code" id="add_assignment_track" required class="w-full px-4 py-2 border rounded-lg">
                        <option value="">Select Track/Strand</option>
                        <!-- Tracks will be populated based on curriculum and grade selection -->
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Section Name *</label>
                    <input type="text" name="section_name" id="assignment_section_name" required class="w-full px-4 py-2 border rounded-lg" placeholder="e.g., Section 1, Section 2">
                    <p class="text-xs text-gray-500 mt-1">
                        <i class="fas fa-info-circle"></i> For JHS: "Section 1", "Section 2", etc. | For SHS: Usually "Section 1" (one section per strand)
                    </p>
                </div>
            </div>
            
            <div class="flex justify-end space-x-3 mt-6">
                <button type="button" onclick="closeAddAssignmentModal()" class="px-4 py-2 border rounded-lg">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg">Add Assignment</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Assignment Modal -->
<div id="editAssignmentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
        <div class="p-6 border-b">
            <div class="flex justify-between items-center">
                <h3 class="text-xl font-semibold">Edit Teacher Assignment</h3>
                <button onclick="closeEditAssignmentModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        
        <form method="POST" class="p-6">
            {% csrf_token %}
            <input type="hidden" name="action" value="edit_assignment">
            <input type="hidden" name="assignment_id" id="edit_assignment_id">
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Teacher Name *</label>
                    <input type="text" name="teacher_name" id="edit_assignment_teacher_name" required class="w-full px-4 py-2 border rounded-lg">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Curriculum *</label>
                    <select name="curriculum_id" id="edit_assignment_curriculum" required class="w-full px-4 py-2 border rounded-lg">
                        <option value="">Select Curriculum</option>
                        {% for curriculum in curricula %}
                        <option value="{{ curriculum.id }}" data-name="{{ curriculum.name }}">{{ curriculum.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Grade Level *</label>
                    <select name="grade_level" id="edit_assignment_grade" required class="w-full px-4 py-2 border rounded-lg">
                        <option value="">Select Grade</option>
                        <!-- Grades will be populated based on curriculum selection -->
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Track/Strand *</label>
                    <select name="track_code" id="edit_assignment_track" required class="w-full px-4 py-2 border rounded-lg">
                        <option value="">Select Track/Strand</option>
                        <!-- Tracks will be populated based on curriculum and grade selection -->
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Section Name *</label>
                    <input type="text" name="section_name" id="edit_assignment_section" required class="w-full px-4 py-2 border rounded-lg">
                </div>
            </div>
            
            <div class="flex justify-end space-x-3 mt-6">
                <button type="button" onclick="closeEditAssignmentModal()" class="px-4 py-2 border rounded-lg">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg">Update Assignment</button>
            </div>
        </form>
    </div>
</div>

<script>
// Auto-generate email based on first name and last name
function generateEmail() {
    const firstName = document.getElementById('id_first_name')?.value.trim() || '';
    const lastName = document.getElementById('id_last_name')?.value.trim() || '';
    const emailField = document.getElementById('teacher_email');
    
    if (firstName && lastName && emailField) {
        // Get first letter of first name (lowercase)
        const firstLetter = firstName[0].toLowerCase();
        // Get last name, remove spaces and special characters, convert to lowercase
        const lastNameClean = lastName.replace(/[^a-zA-Z]/g, '').toLowerCase();
        // Generate email
        const generatedEmail = `${firstLetter}${lastNameClean}dmlmhs.teacher@gmail.com`;
        emailField.value = generatedEmail;
        emailField.placeholder = generatedEmail;
    }
}

// Teacher Account Functions
function openAddTeacherModal() {
    document.getElementById('addTeacherModal').classList.remove('hidden');
    document.getElementById('addTeacherModal').classList.add('flex');
    
    // Add event listeners for auto-email generation
    const firstNameField = document.querySelector('#addTeacherModal input[name="first_name"]');
    const lastNameField = document.querySelector('#addTeacherModal input[name="last_name"]');
    
    if (firstNameField && lastNameField) {
        firstNameField.addEventListener('blur', generateEmail);
        lastNameField.addEventListener('blur', generateEmail);
    }
}

function closeAddTeacherModal() {
    document.getElementById('addTeacherModal').classList.add('hidden');
    document.getElementById('addTeacherModal').classList.remove('flex');
}

function editTeacher(id, firstName, lastName, email) {
    document.getElementById('edit_teacher_id').value = id;
    document.getElementById('edit_first_name').value = firstName;
    document.getElementById('edit_last_name').value = lastName;
    document.getElementById('edit_email').value = email;
    
    document.getElementById('editTeacherModal').classList.remove('hidden');
    document.getElementById('editTeacherModal').classList.add('flex');
}

function closeEditTeacherModal() {
    document.getElementById('editTeacherModal').classList.add('hidden');
    document.getElementById('editTeacherModal').classList.remove('flex');
}

function toggleTeacher(id, name) {
    if (confirm('Toggle status for "' + name + '"?')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.innerHTML = `
            {% csrf_token %}
            <input type="hidden" name="action" value="toggle_teacher">
            <input type="hidden" name="teacher_id" value="${id}">
        `;
        document.body.appendChild(form);
        form.submit();
    }
}

function deleteTeacher(id, name) {
    if (confirm('Delete teacher "' + name + '"? This action cannot be undone.')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.innerHTML = `
            {% csrf_token %}
            <input type="hidden" name="action" value="delete_teacher">
            <input type="hidden" name="teacher_id" value="${id}">
        `;
        document.body.appendChild(form);
        form.submit();
    }
}

// Assignment Functions
function openAddAssignmentModal() {
    document.getElementById('addAssignmentModal').classList.remove('hidden');
    document.getElementById('addAssignmentModal').classList.add('flex');
}

function closeAddAssignmentModal() {
    document.getElementById('addAssignmentModal').classList.add('hidden');
    document.getElementById('addAssignmentModal').classList.remove('flex');
}

function editAssignment(id, teacherName, curriculumId, trackCode, gradeLevel, sectionName) {
    document.getElementById('edit_assignment_id').value = id;
    document.getElementById('edit_assignment_teacher_name').value = teacherName;
    const curriculumSelect = document.getElementById('edit_assignment_curriculum');
    const gradeSelect = document.getElementById('edit_assignment_grade');
    const trackSelect = document.getElementById('edit_assignment_track');
    const sectionInput = document.getElementById('edit_assignment_section');
    
    // Set curriculum and trigger change to populate grades
    if (curriculumId) {
        curriculumSelect.value = curriculumId;
        const curriculumName = curriculumSelect.options[curriculumSelect.selectedIndex].getAttribute('data-name');
        
        // Populate grades based on curriculum
        gradeSelect.innerHTML = '<option value="">Select Grade</option>';
        if (curriculumName === 'Junior High School') {
            for (let i = 7; i <= 10; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `Grade ${i}`;
                if (i == gradeLevel) option.selected = true;
                gradeSelect.appendChild(option);
            }
        } else if (curriculumName === 'Senior High School') {
            for (let i = 11; i <= 12; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `Grade ${i}`;
                if (i == gradeLevel) option.selected = true;
                gradeSelect.appendChild(option);
            }
        }
        
        // Populate tracks based on curriculum
        trackSelect.innerHTML = '<option value="">Select Track/Strand</option>';
        const jhsTracks = ['STE', 'SPA', 'ICT', 'RBEC', 'STVEP'];
        const shsTracks = ['STEM', 'Arts & Design', 'TVL – ICT', 'TVL – SMAW', 'TVL – EIM', 'TVL – Dressmaking', 'TVL – FBS', 'TVL – Bread & Pastry', 'TVL – CSS'];
        
        const tracks = curriculumName === 'Junior High School' ? jhsTracks : shsTracks;
        tracks.forEach(track => {
            const option = document.createElement('option');
            option.value = track;
            option.textContent = track;
            if (track === trackCode) option.selected = true;
            trackSelect.appendChild(option);
        });
    }
    
    sectionInput.value = sectionName;
    
    document.getElementById('editAssignmentModal').classList.remove('hidden');
    document.getElementById('editAssignmentModal').classList.add('flex');
}

function closeEditAssignmentModal() {
    document.getElementById('editAssignmentModal').classList.add('hidden');
    document.getElementById('editAssignmentModal').classList.remove('flex');
}

function deleteAssignment(id, teacherName) {
    if (confirm('Delete assignment for "' + teacherName + '"? This action cannot be undone.')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.innerHTML = `
            {% csrf_token %}
            <input type="hidden" name="action" value="delete_assignment">
            <input type="hidden" name="assignment_id" value="${id}">
        `;
        document.body.appendChild(form);
        form.submit();
    }
}

// Curriculum-based grade and track filtering
document.addEventListener('DOMContentLoaded', function() {
    // Track definitions
    const jhsTracks = ['STE', 'SPA', 'ICT', 'RBEC', 'STVEP'];
    const shsTracks = ['STEM', 'Arts & Design', 'TVL – ICT', 'TVL – SMAW', 'TVL – EIM', 'TVL – Dressmaking', 'TVL – FBS', 'TVL – Bread & Pastry', 'TVL – CSS'];
    
    // Add Assignment Modal - Curriculum change handler
    const addCurriculumSelect = document.getElementById('add_assignment_curriculum');
    const addGradeSelect = document.getElementById('add_assignment_grade');
    const addTrackSelect = document.getElementById('add_assignment_track');
    
    if (addCurriculumSelect && addGradeSelect && addTrackSelect) {
        addCurriculumSelect.addEventListener('change', function() {
            const curriculumName = this.options[this.selectedIndex].getAttribute('data-name');
            addGradeSelect.innerHTML = '<option value="">Select Grade</option>';
            addTrackSelect.innerHTML = '<option value="">Select Track/Strand</option>';
            
            if (curriculumName === 'Junior High School') {
                // Show grades 7-10
                for (let i = 7; i <= 10; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = `Grade ${i}`;
                    addGradeSelect.appendChild(option);
                }
            } else if (curriculumName === 'Senior High School') {
                // Show grades 11-12
                for (let i = 11; i <= 12; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = `Grade ${i}`;
                    addGradeSelect.appendChild(option);
                }
            }
        });
        
        addGradeSelect.addEventListener('change', function() {
            const curriculumName = addCurriculumSelect.options[addCurriculumSelect.selectedIndex].getAttribute('data-name');
            const grade = this.value;
            addTrackSelect.innerHTML = '<option value="">Select Track/Strand</option>';
            
            if (curriculumName === 'Junior High School' && grade) {
                // Show JHS tracks
                jhsTracks.forEach(track => {
                    const option = document.createElement('option');
                    option.value = track;
                    option.textContent = track;
                    addTrackSelect.appendChild(option);
                });
            } else if (curriculumName === 'Senior High School' && grade) {
                // Show SHS tracks (strands)
                shsTracks.forEach(track => {
                    const option = document.createElement('option');
                    option.value = track;
                    option.textContent = track;
                    addTrackSelect.appendChild(option);
                });
            }
        });
    }
    
    // Edit Assignment Modal - Curriculum change handler
    const editCurriculumSelect = document.getElementById('edit_assignment_curriculum');
    const editGradeSelect = document.getElementById('edit_assignment_grade');
    const editTrackSelect = document.getElementById('edit_assignment_track');
    
    if (editCurriculumSelect && editGradeSelect && editTrackSelect) {
        editCurriculumSelect.addEventListener('change', function() {
            const curriculumName = this.options[this.selectedIndex].getAttribute('data-name');
            editGradeSelect.innerHTML = '<option value="">Select Grade</option>';
            editTrackSelect.innerHTML = '<option value="">Select Track/Strand</option>';
            
            if (curriculumName === 'Junior High School') {
                for (let i = 7; i <= 10; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = `Grade ${i}`;
                    editGradeSelect.appendChild(option);
                }
            } else if (curriculumName === 'Senior High School') {
                for (let i = 11; i <= 12; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = `Grade ${i}`;
                    editGradeSelect.appendChild(option);
                }
            }
        });
        
        editGradeSelect.addEventListener('change', function() {
            const curriculumName = editCurriculumSelect.options[editCurriculumSelect.selectedIndex].getAttribute('data-name');
            const grade = this.value;
            editTrackSelect.innerHTML = '<option value="">Select Track/Strand</option>';
            
            if (curriculumName === 'Junior High School' && grade) {
                jhsTracks.forEach(track => {
                    const option = document.createElement('option');
                    option.value = track;
                    option.textContent = track;
                    editTrackSelect.appendChild(option);
                });
            } else if (curriculumName === 'Senior High School' && grade) {
                shsTracks.forEach(track => {
                    const option = document.createElement('option');
                    option.value = track;
                    option.textContent = track;
                    editTrackSelect.appendChild(option);
                });
            }
        });
    }
});
</script>
{% endblock %}
